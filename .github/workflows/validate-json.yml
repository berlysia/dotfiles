name: Validate JSON Templates

on:
  push:
    branches:
      - master
      - main
    paths:
      - '**/*.json.tmpl'
      - '**/*.json'
      - '.github/workflows/validate-json.yml'
      - '.github/scripts/validate-json-templates.sh'
      - '.github/scripts/check-trailing-commas.sh'
      - '.github/ci-chezmoi-data.json'
  pull_request:
    paths:
      - '**/*.json.tmpl'
      - '**/*.json'
      - '.github/workflows/validate-json.yml'
      - '.github/scripts/validate-json-templates.sh'
      - '.github/scripts/check-trailing-commas.sh'
      - '.github/ci-chezmoi-data.json'

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y jq

    - name: Install chezmoi
      run: |
        sh -c "$(curl -fsLS get.chezmoi.io)" -- -b /usr/local/bin

    - name: Make scripts executable
      run: |
        chmod +x .github/scripts/*.sh

    - name: Validate JSON templates
      run: .github/scripts/validate-json-templates.sh .github/ci-chezmoi-data.json

    - name: Check for trailing commas
      run: .github/scripts/check-trailing-commas.sh