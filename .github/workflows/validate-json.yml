name: Validate JSON Templates

on:
  push:
    branches:
      - master
      - main
    paths:
      - '**/*.json.tmpl'
      - '**/*.json'
      - '.github/workflows/validate-json.yml'
      - '.github/scripts/validate-json-templates.sh'
      - '.github/scripts/check-trailing-commas.sh'
      - '.github/ci-chezmoi-data.json'
      - '.github/actions/install-chezmoi/**'
  pull_request:
    paths:
      - '**/*.json.tmpl'
      - '**/*.json'
      - '.github/workflows/validate-json.yml'
      - '.github/scripts/validate-json-templates.sh'
      - '.github/scripts/check-trailing-commas.sh'
      - '.github/ci-chezmoi-data.json'
      - '.github/actions/install-chezmoi/**'

jobs:
  validate:
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
    - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6
      with:
        persist-credentials: false

    - name: Install chezmoi
      uses: ./.github/actions/install-chezmoi

    - name: Make scripts executable
      run: |
        chmod +x .github/scripts/*.sh

    - name: Validate JSON templates
      run: .github/scripts/validate-json-templates.sh .github/ci-chezmoi-data.json

    - name: Check for trailing commas
      run: .github/scripts/check-trailing-commas.sh