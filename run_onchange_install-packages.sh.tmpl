{{ if ne .chezmoi.os "windows" -}}
#!/bin/bash

{{ if eq .chezmoi.os "linux" -}}

sudo apt-get update
sudo apt-get install -y wget curl emacs git build-essential fzf bat ripgrep jq zsh unzip

mkdir -p ~/.local/bin
ln -s /usr/bin/batcat ~/.local/bin/bat

{{ end -}}

{{ if eq .chezmoi.os "darwin" -}}

mkdir -p ~/.local/bin

xcode-select --install || :

if brew --version; then
  echo "brew already installed"
else
  # https://brew.sh/index_ja.html
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

  if [ -f /opt/homebrew/bin/brew ]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"
  elif [ -f /usr/local/bin/brew ]; then
    eval "$(/usr/local/bin/brew shellenv)"
  fi

  # https://github.com/rcmdnk/homebrew-file
  brew install rcmdnk/rcmdnkpac/homebrew-file || :
  brew file install

  $(brew --prefix)/opt/fzf/install

  ln -s $(brew --prefix)/opt/curl/bin/curl ~/.local/bin/curl
fi

{{ end -}}

if mise --version; then
  echo "mise already installed"
else
  # https://mise.jdx.dev/
  curl https://mise.run | MISE_INSTALL_PATH=~/.local/bin/mise sh
fi

if bun --version; then
  echo "bun already installed"
else
  local BUN_VERSION=`mise latest bun 2&>1 /dev/null`
  mise install bun $BUN_VERSION
  mise use bun@$BUN_VERSION
fi

if node --version; then
  echo "node already installed"
else
  local NODE_VERSION=`mise latest node 2&>1 /dev/null`
  mise install node $NODE_VERSION
  mise use node@$NODE_VERSION
fi

{{ end }}
