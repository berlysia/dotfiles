{{ if ne .chezmoi.os "windows" -}}
#!/bin/bash
# Sync .skills to ~/.claude/skills and ~/.codex/skills

set -euo pipefail

SKILLS_SOURCE="{{ .chezmoi.sourceDir }}/.skills"
CLAUDE_SKILLS="$HOME/.claude/skills"
CODEX_SKILLS="$HOME/.codex/skills"

# Create directories if they don't exist
mkdir -p "$CLAUDE_SKILLS" "$CODEX_SKILLS"

# Sync .skills to ~/.claude/skills and ~/.codex/skills
echo "Syncing handcrafted skills from .skills..."

# Build exclude filter for external skills
EXCLUDE_ARGS=()
if [ -f "$HOME/.claude/.external-skills-installed" ]; then
  while IFS= read -r skill_name; do
    [ -n "$skill_name" ] && EXCLUDE_ARGS+=(--exclude="$skill_name")
  done < "$HOME/.claude/.external-skills-installed"
fi

# Sync with --delete, but preserve external skills
# Also exclude ui-skills (managed by chezmoi external)
rsync -a --delete --exclude="ui-skills" "${EXCLUDE_ARGS[@]}" "$SKILLS_SOURCE/" "$CLAUDE_SKILLS/"
rsync -a --delete --exclude="ui-skills" "${EXCLUDE_ARGS[@]}" "$SKILLS_SOURCE/" "$CODEX_SKILLS/"

echo "âœ… Handcrafted skills synced successfully"
{{ end -}}
