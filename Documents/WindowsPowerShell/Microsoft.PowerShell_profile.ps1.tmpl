{{ if eq .chezmoi.os "windows" -}}
# Windows PowerShell Profile (PowerShell 5.1)

# Initialize mise environment if available
if (Get-Command mise -ErrorAction SilentlyContinue) {
    try {
        $miseEnv = & mise env --shell pwsh 2>$null
        if ($LASTEXITCODE -eq 0 -and $miseEnv) {
            # Convert array to string if necessary
            $envScript = if ($miseEnv -is [Array]) { $miseEnv -join "`n" } else { $miseEnv }
            Invoke-Expression $envScript
        }
    } catch {
        # Silently continue if mise activate fails
    }
}

# Add user local bin to PATH if not already present
$localBin = "$env:USERPROFILE\.local\bin"
if (Test-Path $localBin) {
    $currentPath = $env:PATH
    if ($currentPath -notlike "*$localBin*") {
        $env:PATH = "$localBin;$currentPath"
    }
}

# Set up Go environment variables
if (Get-Command go -ErrorAction SilentlyContinue) {
    if (-not $env:GOPATH) {
        $env:GOPATH = "$env:USERPROFILE\go"
    }
    $goBin = "$env:GOPATH\bin"
    if ((Test-Path $goBin) -and ($env:PATH -notlike "*$goBin*")) {
        $env:PATH = "$goBin;$env:PATH"
    }
}

# Set up Rust environment
$cargoEnv = "$env:USERPROFILE\.cargo\env.ps1"
if (Test-Path $cargoEnv) {
    & $cargoEnv
}

{{ end -}}