# Development Guidelines

## Language
- Japanese for discussion, English for code

## Workflow
1. **Explore** - Understand codebase and requirements
2. **Plan** - Design solution with clear steps
3. **Code** - Implement following best practices
4. **Commit** - Clean, meaningful commits

## Development Principles

### Code Quality
- Clean formatting, descriptive names, idiomatic patterns
- **コメント方針**: 
  - **WHYを説明**: コードの理由・背景・制約を記述する。
  - **型システム尊重**: TypeScript型定義から自明な情報はコメントで重複しない
  - **ビジネスロジック重視**: ドメイン知識・設計決定・トレードオフの説明に集中
  - **差分ではなく現状を説明する**: 変更適用後のコードが何をしているかに対して説明する
- Comprehensive error handling and parallelization

### Developer Experience
- Minimize developer friction
- Thorough planning before implementation
- Root cause analysis for bug fixes
- Create scripts for repetitive tasks
- **Decision transparency**: When changing approach mid-task, explicitly explain the reasoning and new plan before proceeding

### Architecture
- **Libraries**: Minimal dependencies, prefer built-ins
- **Design**: Respect existing architecture, maintain unidirectional dependency graph
- **Documentation**: Record significant decisions in ADRs (Architecture Decision Records)
- **Patterns**: Abstract repeated patterns, use tools like `similarity-ts` for detection, `knip` for cleaning

### Testing
- Follow t-wada's TDD style
- Strict Red-Green-Refactor cycle
- Tests must pass before commits

## TypeScript Project Standards
- Package manager: `pnpm`
  - Must use `minimalReleaseAge` with value means 1 week in minutes at least
- Linting: `oxlint`
- Formatting: `prettier`
- Cleaning: `knip`
- Testing for browser: `Vitest`
- Testing for CLI: `node:test`
- No `any` types
- Prefer `async/await`

## Security Requirements
- **Prohibited**: Hardcoded secrets, unvalidated inputs, suppressed errors
- **Required**: Input validation, environment variables, comprehensive logging, passing lint/test

## Git Workflow

### Worktree Management
- **Create**: `git-worktree-create <branch-name>`
  - Location: `.git/worktree/` directory
  - Auto-creates branch from current if needed
  - Uses existing local/remote branches when available
  
- **Cleanup**: `git-worktree-cleanup`
  - Safely removes completed worktrees
  - Preserves worktrees with uncommitted changes or unpushed commits
  - Auto-prunes after deletion

### Commit Standards
- All tests and lints must pass
- Clear, descriptive commit messages
- Use semantic commits with conventional prefixes (feat:, fix:, docs:, etc.)
- Break large changes into logical, atomic commits
- Use `/commit` command for guided semantic commit workflow

## Useful Commands

### Code Analysis
- **similarity-ts**: Detect code duplication
  - `similarity-ts src/`
  - `similarity-ts --threshold 0.8 src/`

### Git Tools
- **git-sequential-stage**: Stage specific hunks for semantic commits
  - `git-sequential-stage -patch="changes.patch" -hunk="file.go:1,3,5"`
  - Used by `/commit` command for precise staging

## Temporal Directory
- If you are in some project, use `${projectRoot}/.tmp` 

## Knowledge Management

### 推奨ドキュメント構造
プロジェクトの `.claude/CLAUDE.md` で定義することを推奨。標準的な構造：
- `.tmp/docs/` - 作業中の一時ファイル（gitignore）
- `docs/decisions/` - Architecture Decision Records (ADR)
- `docs/` - その他の完成したドキュメント

### 記録の原則
- **作業中**: `.tmp/` 配下に配置（gitignore推奨）
- **完成品**: `docs/` 配下に配置（git管理）
- **重要な意思決定**: ADRとして記録

**Critical Rule:**
Always gather evidence (read files, run tests, check actual state) before making decisions. Use **logic-validator** proactively to catch assumption-based reasoning.